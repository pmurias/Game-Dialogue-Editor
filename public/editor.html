<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns:ng="http://angularjs.org">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
        <script type="text/javascript"
            src="http://angularjs.org/ng/js/angular-debug.js" ng:autobind>
        </script>
        <script>
            angular.filter.label = function(reaction) {
                return reaction.text[0];
            }

            function ReactionController() {
            }
            ReactionController.prototype = {
                addText: function() {
                    this.reactions[this.selected_reaction].text.push("");
                },
                addReply: function() {
                    this.reactions[this.selected_reaction].replies.push({text:[""],reactions:[]});
                }
            };

            function ReactionsController() {
            }
            ReactionsController.prototype = {
                addReaction: function() {
                    this.reactions.push({
                        text:[''],
                        replies:[]
                    });
                }
            };

            function ReplyController() {
            }
            ReplyController.prototype = {
                addReaction: function() {
                    this.reply.reactions.push(0);
                },
                addText: function() {
                    this.reply.text.push("");
                }
            };
        </script>
    </head>
    <body ng:controller="ReactionsController">
        <span/ ng:init="
            selected_reaction = 0;
            reactions = [
                {
                    text:['Witam','Jesteś tu sam?'],
                    replies:[
                        {
                            text:['Oczywiście że jestem sam.'],
                            reactions: [0,0]
                        },
                        {
                            text:['Przyszedłem z ekipą zrobić ci wjazd na chatę.'],
                            reactions: []
                        }
                    ]
                },
                {
                    text:['Stój złodzieju'],
                    replies:[]
                }
            ]">

            <select name='selected_reaction' style="display:block;">
            <option ng:repeat='reaction in reactions' value="{{$index}}">{{reaction|label}}</option>
        </select>
        <button id="add_reaction" ng:click="addReaction()">Add new reaction</button>
        <div ng:controller="ReactionController">

            <span ng:repeat="text in reactions[selected_reaction].text">
                <textarea name='reactions[selected_reaction].text[$index]'></textarea>
                <a href="" ng:click="reactions[selected_reaction].text.splice($index,1)">Remove</a>
            </span>

            <a href="" ng:click="addText()">Add</a>

            <span ng:controller="ReplyController" ng:repeat="reply in reactions[selected_reaction].replies">
            <div  style="border:1em solid;" >

                <span ng:repeat="text in reply.text">
                    <textarea name='reply.text[$index]' ></textarea>
                    <a href="" ng:click="reply.text.splice($index,1)">Remove</a>
                </span>

                <a href="" ng:click="addText()">Add</a>

                Conditions:
                <textarea name='reply.conditions'></textarea>

                Actions:
                <textarea name='reply.actions'></textarea>

                Reactions:
                <span ng:repeat="reaction in reply.reactions">
                    <select name='reply.reactions[$index]' >
                        <option ng:repeat='possibleReaction in reactions' value="{{$index}}">{{possibleReaction|label}}</option>
                    </select>
                    <a href="" ng:click="reply.reactions.splice($index,1)">Remove</a>
                </span>
                <a href="" ng:click="addReaction()">Add</a>


            </div>
            <a href="" ng:click="reactions[selected_reaction].replies.splice($index,1)">Remove</a>
            </span>
            <button ng:click="addReply()">Add new reply</button>
        </div>

        <pre>
            {{reactions}}
        </pre>
 </body>
</html>
